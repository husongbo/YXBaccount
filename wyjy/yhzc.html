<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta name="misapplication-tap-highlight" content="no" />
    <meta name="HandheldFriendly" content="true" />
    <meta name="MobileOptimized" content="320" />
    <meta http-equiv="Expires" content="0" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Cache-control" content="no-cache" />
    <meta http-equiv="Cache" content="no-cache" />
    <title>注册</title>
	<link rel="stylesheet" href="../Common/css/mui.min.css" />
	<link rel="stylesheet" href="../Common/css/city/mui.picker.css" />
	<link rel="stylesheet" href="../Common/css/city/mui.poppicker.css" />
	<link rel="stylesheet" href="../Common/css/city/element.min.css" />
	<link rel="stylesheet" href="../Common/css/city/loadings.css" />
	<script type="text/javascript" src="../Common/js/jquery-3.1.1.js"></script>
    <script type="text/javascript" src="../Common/js/zepto.js"></script>
	<script type="text/javascript" src="../Common/js/mui.js"></script>
    <script type="text/javascript" src="../Common/js/sm.js?1=1"></script>
    <script type="text/javascript" src="../Common/js/sm-extend.js"></script>
    <script type="text/javascript" src="../Common/js/sm-city-picker.js"></script>
    <script type="text/javascript" src="../Common/js/sdk.js"></script>
    <script type="text/javascript" src="../Common/js/sdk_data_validation.js"></script>
    <script type="text/javascript" src="../Common/js/sdk_db.js?1=1"></script>
    <script type="text/javascript" src="../Common/js/Bill.js"></script>
    <script type="text/javascript" src="../Common/js/layer_mobile/layer.js"></script>
	<script type="text/javascript" src="../Common/js/vue.min.js"></script>
	<script type="text/javascript" src="../Common/js/city/element.min.js"></script>
	<style>
	    @font-face {
	        font-family: 'iconfont'; /* project id 705767 */
	        src: url('//at.alicdn.com/t/font_705767_wsdw7wzndb.eot');
	        src: url('//at.alicdn.com/t/font_705767_wsdw7wzndb.eot?#iefix') format('embedded-opentype'), url('//at.alicdn.com/t/font_705767_wsdw7wzndb.woff') format('woff'), url('//at.alicdn.com/t/font_705767_wsdw7wzndb.ttf') format('truetype'), url('//at.alicdn.com/t/font_705767_wsdw7wzndb.svg#iconfont') format('svg');
	    }
	    .iconfont {
	        font-family: "iconfont" !important;
	        font-size: 16px;
	        font-style: normal;
	        -webkit-font-smoothing: antialiased;
	        -moz-osx-font-smoothing: grayscale;
	    }
	    @font-face {
	        font-family: 'iconfont'; /* project id 796516 */
	        src: url('//at.alicdn.com/t/font_796516_0sil0vqv2a5j.eot');
	        src: url('//at.alicdn.com/t/font_796516_0sil0vqv2a5j.eot?#iefix') format('embedded-opentype'), url('//at.alicdn.com/t/font_796516_0sil0vqv2a5j.woff') format('woff'), url('//at.alicdn.com/t/font_796516_0sil0vqv2a5j.ttf') format('truetype'), url('//at.alicdn.com/t/font_796516_0sil0vqv2a5j.svg#iconfont') format('svg');
	    }
	    .icon-duanxin:before {
	        content: "\e618";
	        color: #ff8200;
	    }
	    .icon-dizhi01:before {
	        content: "\e62c";
	        color: #ffc600;
	    }
	
	    .icon-shouji:before {
	        content: "\e607";
	        color: #a535e9;
	    }
	
	    .icon-yonghudianji:before {
	        content: "\e638";
	        color: #1375ff;
	    }
	
	    .icon-nationaarea:before {
	        content: "\e624";
	        color: #ff9800;
	    }
	
	    .icon-youjian:before {
	        content: "\e62b";
	        color: #ee2683;
	    }
	
	    .icon-shenfenzheng:before {
	        content: "\e696";
	        color: #f94d1b;
	        font-size:0.5rem;
	    }
	    .title {
	        background-color: #ffffff;
	        color: #000;
	    }
	    .list-block {
	        margin: 0;
	        font-size: 0.65rem;
	        color: #333
	    }
	   .list-block input[type="text"] {
	       font-size: 0.6rem;
	       color:#999
	   }
	   .list-block .item-inner {
	        padding-right:0;
	   }
	   .list-block .item-content {
	       padding-right: 0.75rem;
	   }
	    .page, .page-group {
	        background:#fff;
	    }
	  
	    .iconfont {
	        width: 2.5rem;
	    }
	    .tijiao {
	        background-color: #ff8200;
	        color: #fff;
	        padding: 0 1.4rem;
	        border:none;
	    }
	    .jbxx-content {
	        background: url("../Common/image/jbxx/bg_img.png") no-repeat center top;
	        margin-top:0.5rem;
	        background-size:100% 100%;
	        padding-bottom:0.5rem;
	    }
	    .fsyzm {
	        position:absolute;  
	        right:0.3rem;
	    }
	    .fsyzm-button {
	        background: #ff8200;
	        border:none;
	        color:#fff;
	        height:1.1rem;
	        line-height:1rem;
	        font-size:0.6rem;
	    }
	    a:active {
	        color: #fff ;
	        text-decoration:none; 
	    }
	
	</style>
	<style>
        .page{
			    
				height: 200px;
				height: calc(100vh - 44px);
				margin-top: 44px;
				background: white;
				position: relative;
				padding: 0 10px;
				padding-top: 20px;
				/* display: flex;
				align-items: center; */
		}
		.pages{
			    background: url(../Common/image/jbxx/bg_img.png) no-repeat center top;
				margin-top: 0.5rem;
				background-size: 100% 100%;
				padding-bottom: 0.5rem;
				/* height: 400px; */
				width: 100%;
				padding: 10px;
		}
		.pagesinput{
			display: flex;
			flex-direction: row;
			height: 40px;
			align-items: center;
			margin-bottom: 10px;
		}
		.ins{
			height: 40px;
			line-height: 40px;
			width: 100px;
			font-size: .8rem;
		}
		.mui-btn{
			height: 40px;
			display: flex;
			align-items: center;
			padding: 0;
			justify-content: center;
		}
		#myVue{
			box-shadow: 0 0 0.6rem rgba(220, 220, 220, 0.6);
			/* padding: 20px 10px; */
		}
		.labels{
			color: #8C8C8C;
			font-size: .8rem;
		}
		input{
			color: #8C8C8C;
		}
		.actives{
			display: none;
		}
	</style>
</head>
<body>
	<header class="mui-bar mui-bar-nav">
		<!-- <span class=" mui-icon  mui-pull-left" onclick='history.back(-1)'>
			<img src="../Common/image/bzfk/back.png" style="width: 25px;height: 25px;">
		</span> -->
		<h1 class="mui-title">注册</h1>
	</header>
	<div id="myVue">
		<div class="page" style="">
			<div class="pages" style="margin-top: 10%;">
				<div class="pagesinput">
					<i class="iconfont icon-yonghudianji"></i>
					<div style="width: 20%;" class="labels">手机号</div>
					<div style="display: flex;justify-content: center;width: 100%;">
						<input v-model="Phone" class="ins" id="name" style="width: 100%;border: 0;margin-bottom: 0;" type="text" placeholder="请输入您的手机号" />
					</div>
				</div>
				<div class="pagesinput">
					<i class="iconfont icon-shenfenzheng"></i>
					<div style="width: 20%;" class="labels">验证码</div>
					<div style="display: flex;width: 100%;flex-direction: row;align-items: center;">
						<input v-model="yztext" class="ins" id="phone" style="width: 70%;border: 0;margin-bottom: 0;padding-right: 0;" type="text" placeholder="请输入您的验证码" />
						<div @click="GotoYzm" id="YZM" style="display: flex;align-items: center;color: red;font-size: .7rem;background: #f0ad4e;padding: 0 5px;color: white;border-radius: 5px;height: 25px;min-width: 70px;justify-content: center;">获取验证码</div>
					</div>
				</div>
				<button type="button" class="mui-btn mui-btn-warning mui-btn-block" @click="Tjs">提交</button>
			</div>
		</div>
	</div>
</body>
	<script src="../Common/js/city/loadings.js"></script>
	<script src="../Common/js/city/mui.picker.js"></script>
	<script src="../Common/js/city/mui.poppicker.js"></script>
	<script src="../Common/js/city/city.data.js" type="text/javascript" charset="utf-8"></script>
	<script src="../Common/js/city/city.data-3.js" type="text/javascript" charset="utf-8"></script>
	<script src="../Common/js/city/crypto-js.js" type="text/javascript" charset="utf-8"></script>
	<script src="../Common/js/city/util.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		
	</script>
	<script type="text/javascript">
		var href=window.location.href.split('?')
		var hrefs=href[1].split(',')
		var codes=hrefs[0].split('=')
		var proid=hrefs[1].split('=')
		new Vue({
		    el: '#myVue',
			data: {
			    stepVal1: 0,
				Num:'获取验证码',
				Phone:'',
				yztext:'',
				Phonetext:/^1[3456789]\d{9}$/,
				Code:codes[1],
				ProId:proid[1],
				userid:'',
			},
			created(){
				var _this=this	
				var proc = "查询基本信息 " + Bill.userId;
				var rst = $$.JSONDB.Query(proc);
				if (!rst) {
					mui.toast('没有查到用户数据',{
						duration:1000
					});
					return 0;
				}
				var data = rst.Table[0];
				if (!data) {
					mui.toast('没有查到用户数据',{
						duration:1000
					});
					return 0;
				}
				else{
					_this.userid=data.用户标识;
					if (data.手机) {
						$.ajax({
						    type: "post",
						    url: `http://smstest.youxinbao.com.cn/App/Common/CSharp/app/user/UserInfo.ashx?params={method:"CheckInvationCode",user_id:"${_this.userid}",invation_code:"${_this.Code}",promote_id:"${_this.ProId}"}`,
						    data: {},
						    async: true,
						    success: function (data) {
						       console.log(data)
							   if((JSON.parse(data).isexists=='true'||JSON.parse(data).isexists==true)&&JSON.parse(data).message=='邀请码正确'){
								   return
							   }
							   else{
								   window.location.href=`http://wwww.baidu.com`
							   }
						    }
						});
					}	
				}
			},
			methods:{
				GotoYzm(){
					var _this=this
					if(!this.Phonetext.test(this.Phone)){
						mui.toast('请输入正确的手机号',{
							duration:1000
						});
						return false
					}
					$.ajax({
					    type: "post",
					    url: `http://smstest.youxinbao.com.cn/App/Common/CSharp/app/user/UserInfo.ashx?params={method:"SendVerfyCode",phone:"${this.Phone}"}`,
					    data: {},
					    async: true,
					    success: function (data) {
							if(JSON.parse(data).result==0){
								_this.Num=60
								$("#YZM").text(_this.Num)
								mui.toast('验证码发送成功',{
									duration:1000
								});
								var SetIn=setInterval(()=>{
									_this.Num--
									$("#YZM").text(_this.Num)
									if(_this.Num==0){
										clearInterval(SetIn)
										_this.Num='获取验证码'
										$("#YZM").text(_this.Num)
									}
								},1000)
							}
							else{
								mui.toast('验证码发送失败',{
									duration:1000
								});
							}
					       console.log(data)
					    }
					});	
					
				},
				Tjs(){
					var _this=this
					var Flag=this.Verification()
					if(Flag){
						console.log("ok")
						$.ajax({
						    type: "post",
						    url: `http://smstest.youxinbao.com.cn/App/Common/CSharp/app/user/UserInfo.ashx?params={method:"BindPhone",user_id:"${_this.userid}",phone:"${this.Phone}",invation_code:"${this.Code}"}`,
						    data: {},
						    async: true,
						    success: function (data) {
								mui.showLoading("注册中...","div")
						       console.log(data)
							   if(JSON.parse(data).result==0&&JSON.parse(data).message=='手机号码已存在'){
								   setTimeout(()=>{
									   mui.hideLoading()
									   mui.toast(JSON.parse(data).message,{
									   	duration:1000
									   });
								   },1000)   
							   }
							   else{
								   setTimeout(()=>{
									   mui.hideLoading()
									   mui.toast(JSON.parse(data).message,{
										duration:1000
									   });
									   setTimeout(()=>{
										   window.location.href=`http://wwww.baidu.com?code=${_this.Code}`
									   },1000)
								   },1000) 
							   }	   
						    },
							error:function(err){
								console.log(err)
							}
						});	
					}
				},
				Verification(){
					var _this=this
					if(!this.Phonetext.test(this.Phone)){
						mui.toast('请输入正确的手机号',{
							duration:1000
						});
						return false
					}
					else if(this.yztext==''||this.yztext==null){
						mui.toast('验证码不能为空',{
							duration:1000
						});
						return false
					}
					else{
						var falgs=false
						$.ajax({
						    type: "post",
						    url: `http://smstest.youxinbao.com.cn/App/Common/CSharp/app/user/UserInfo.ashx?params={method:"CheckSmsValidateCode",phone:"${this.Phone}",sms_validate_code:"${this.yztext}"}`,
						    data: {},
						    async: false,
						    success: function (data) {
						       console.log(JSON.parse(data))
							   if(JSON.parse(data).result==0){
								   falgs=true
							   }
							   else{
								   mui.toast('验证码不正确',{
								   	duration:1000
								   });
								   _this.yztext=''
								   falgs=false
								   console.log(falgs)
							   }
						    },
							error:function(err){
								console.log(err)
							}
						});	
						return falgs
					}
				}
			}
	    })
	</script>
	
<script type="text/javascript">
	
</script>
</html>