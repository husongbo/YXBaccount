<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>购买加油券</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta name="misapplication-tap-highlight" content="no" />
    <meta name="HandheldFriendly" content="true" />
    <meta name="MobileOptimized" content="320" />
    <meta http-equiv="Expires" content="0" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Cache-control" content="no-cache" />
    <meta http-equiv="Cache" content="no-cache" />

    <link rel="stylesheet" href="../Common/css/sm.css" />

    <script type="text/javascript" src="../Common/js/zepto.js"></script>
    <script type="text/javascript" src="../Common/js/sdk.js"></script>
    <script type="text/javascript" src="../Common/js/sdk_data_validation.js"></script>
    <script type="text/javascript" src="../Common/js/sdk_db.js?1=1"></script>
    <script type="text/javascript" src="../Common/js/Bill.js"></script>
    <script type="text/javascript" src="../Common/js/qrcode.min.js"></script>
    <script type="text/javascript" src="../Common/js/utf.js"></script>
    <script type="text/javascript" src="../Common/js/layer_mobile/layer.js"></script>
    <script type="text/template" id="couponList_Template">
        <div class="yhq-list">
            <div class="card card-list">
                <div class="content-padded grid-demo">
                    <div class="row">
                        <div class="row-left">
                            <span class="fh">￥</span><span class="row-price">{{礼品价格}}</span>
                        </div>
                        <div class="row-right">
                            <div class="title-yxq">
                                <div class="lp-title">油信宝加油券</div>
                                <div class="lp-yxq">领券日期：{{发放日期}}</div>
                            </div>

                            <div class="lp-bz">支付时抵扣</div>
                        </div>
                    </div>
                </div>
            </div>
            <label class="label-checkbox item-content">
                <input type="checkbox" name="my-checkbox" id="{{礼品标识}}" value="{{礼品价格}}" class="checkbox-money" />
                <div class="item-media checkbox-div">
                    <i class="icon icon-form-checkbox"></i>
                </div>
            </label>

        </div>

    </script>
    <style>
        .page, .page-group {
            background: #fff;
        }

        .title {
            background: #fff;
        }

        input[type='number'] {
            border: none;
            width: 90%;
            box-sizing: border-box;
            padding-left: 5%;
            font-size: 0.6rem;
            padding-bottom: 0.3rem;
        }

        .content-block-title {
            margin-top: 0.5rem;
            font-weight: bold;
        }

        .checkbox-money {
            height: 4rem;
            line-height: 4rem;
        }

        label.label-checkbox input[type="checkbox"]:checked + .item-media i.icon-form-checkbox {
            background-color: #ff8200;
        }

        .yh-yhjts img {
            height: 0.7rem;
        }

        .yh-yhjts {
            font-size: 0.6rem;
            height: 0;
            min-height: 0rem;
            padding-left: 0.3rem;
        }
        .row {
            margin: 0;
        }

        .row-left {
            width: 30.7%;
            float: left;
            text-align: center;
            height: 4rem;
            line-height: 4rem;
            color: #fff;
        }

        .row-right {
            width: 69.3%;
            margin-left: 30%;
            padding-left: 1rem;
        }

        .row-price {
            font-size: 1rem;
            font-family: DIN-Bold;
        }

        .ljlq {
            width: 25%;
            float: left;
            padding-top: 1.6rem;
        }
            .ljlq img {
                width: 80%;
            }

        .lp-yxq {
            font-size: 0.6rem;
        }

        .content-padded {
            margin: 0 auto;
        }
        .lp-title {
            padding: 0.3rem 0;
            font-size: 0.65rem;
            font-weight: 600;
            color: #333;
        }

        .title-yxq {
            width: 100%;
            float: left;
            color: #666;
        }

        .lp-bz {
            bottom: 0.15rem;
            position: absolute;
            color: #999;
            font-size: 0.6rem;
        }

        .content-padded {
            padding-top: 0.2rem;
            width: 100%;
        }
        #couponList .card {
            margin: 0;
            box-shadow: none;
            background: url("../Common/image/wycz/img_diyongquan.png") no-repeat left top;
            background-size: 100% 100%;
            width: 85%;
            float: left;
            height: 4.3rem;
        }
        .color-gray {
            color: #e4393c;
        }
        yhq-list {
            padding-bottom: 0.5rem;
        }

        .card-footer {
            margin-top: 1rem;
            padding: 0
        }

        #cz {
            background-color: #ff8200;
            color: #FFFFFF;
            font-weight: bold;
            -- border-radius:0.3rem;
        }

        .js-button {
            background-color: rgba(0,0,0,0);
        }

        .bar-tab:before {
            background-color: rgba(0,0,0,0);
        }

        .content-block-title {
            margin-top: 0.5rem;
            font-weight: bold;
        }

        .card-header:after {
            background-color: rgba(0, 0, 0, 0)
        }
        label.label-checkbox i.icon-form-checkbox {
            border: 1px solid #ff8200;
        }
        .checkbox-div {
            height: 4.3rem;
            line-height: 4.3rem;
        }
        .icon-form-checkbox {
            left: 5%;
        }
        .price {
            font-size: 1rem;
            color: #e4393c;
            margin-bottom: 1%;
            margin-top: -3%;
            font-weight: bold;
        }
        .list-block {
            margin:0.75rem 0;
        }
        .shuoming-box {
            background: url("../Common/image/gmjyq/xflf.png") no-repeat center top;
            background-size: 100% auto;
            text-align: center;
            display: none;
            position: absolute;
            top: 14%;
            z-index: 999;
            border-radius: 0.3rem;
            width: 100%;
           
        }

        .shuoming-content {
            padding: 15% 6% 0 6%;
            color: #FFFFFF;
            font-size: 0.8rem;
         
        }
        .shuoming-content div {
            color: #ffffff;
            font-size: 1.2rem;
            padding:1rem 0;
        }
        .quxiao {
            background-color: rgba(0, 0, 0, 0);
            height: 12%;
            width: 36%;
            position: absolute;
            bottom: 14%;
            left: 14%;
        }
        .quding {
            background-color: rgba(0, 0, 0, 0);
            height: 12%;
            width: 36%;
            position: absolute;
            bottom: 14%;
            right: 14%;
        }


        .huojiang-box {
            background: url("../Common/image/gmjyq/huojiang.png") no-repeat center top;
            background-size: 100% auto;
            text-align: center;
            display: none;
            width: 100%;
            position: absolute;
            top: 14%;
            z-index: 999;
            border-radius: 0.3rem;
        }

        .huojiang-content {
            padding: 5% 6% 0 6%;
            color: #FFFFFF;
            font-size: 2rem;
            padding-top:46%;
            padding-right:18%;

        }

            .huojiang-content span {
                color: #ffffff;
                font-size: 1rem;
                padding: 1rem 0;
            }
        .huojiang-guanbi {
            background-color: rgba(0, 0, 0, 0);
            height: 2rem;
            width: 2rem;
            position: absolute;
            bottom: 0.1rem;
            right: 44%;
        }


        .weihuojiang-box {
            background: url("../Common/image/gmjyq/weihuojiang.png") no-repeat center top;
            background-size: 100% auto;
            text-align: center;
            display: none;
            width: 100%;
            position: absolute;
            top: 14%;
            z-index: 999;
            border-radius: 0.3rem;
        }
        .weihuojiang-guanbi {
            background-color: rgba(0, 0, 0, 0);
            height: 2rem;
            width: 2rem;
            position: absolute;
            bottom: 6%;
            right: 44%;
        }

    </style>
</head>

<body>
    <div class="page-group">
        <div class="page page-current" id="main">
            <!-- 遮罩层 -->
            <div id="cover" style="background: #000; position: absolute; left: 0px; top: 0px; width: 100%; filter: alpha(opacity=30); opacity: 0.7; display: none; z-index: 102 "></div>
            <!-- 弹窗 -->
            <div class="shuoming-box">
                <!--   <div class="shuoming-close close-shuoming"> <img src="../Common/image/gmjyq/btn_guanbi.png" /> </div>-->
                <div class="shuoming-content">
                </div>
                <div class="quxiao"></div>
                <div class="quding"></div>
            </div>

            <!-- 弹窗 -->
            <div class="huojiang-box">
                <div class="huojiang-content">
                </div>
                <div class="huojiang-guanbi"></div>

            </div>

            <!-- 弹窗 -->
            <div class="weihuojiang-box">
                <div class="weihuojiang-guanbi"></div>

            </div>

            <header class="bar bar-nav Color_B1">
                <a class="icon icon-left pull-left back" style="color: #333;" onclick="window.history.back()"></a>
                <h1 id="MainPage_Title" class="title" style="color: #333;">购买加油券</h1>
                <a class="icon pull-right" style="color: #333;font-size:0.7rem" onclick="$$.Goto('ewmjyjl');">交易记录</a>
            </header>
            <nav class="bar bar-tab js-button">
                <a class="tab-item external" style="font-weight: bold;">
                    <span style="font-size: 0.65rem;color: #333;">应支付:</span>
                    <span id="total" style="color: #ff8200;font-size: 0.85rem;">￥0.00</span>
                </a>
                <a class="tab-item external" id="cz">结算</a>
            </nav>

            <div id="PageContent" class="content">
                <div class="card margin-zero">
                    <div class="card-content czje">
                        <div class="card-content-inner">
                            <p class="cz-czje">加油金额</p>
                            <p style=" border-bottom: 1px solid #DDDDDD;margin-top:1.7rem" class="je">
                                <span style="font-size: 0.6rem;font-weight: normal;">￥</span>
                                <input type="number" />
                                <div class="container"></div>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="border"></div>


                <div class="content-block-title mode-title bklc-title yjy-title">
                    <a class="icon pull-right" style="color:#333;"></a>优惠券
                </div>
                <div class="yhq-list-box">
                    <div class="card" hidden id="no-dyq">

                        <div class="card-header yh-yhjts">
                            <div class="yhjts-img">
                                <img src="../Common/image/wycz/no-dyq.png" alt="" />
                                <span>优惠券</span>
                            </div>
                            <div class="color-gray">无抵用券使用</div>
                        </div>
                    </div>

                    <div class="card" id="dyq">

                        <div class="card-header yh-yhjts">
                            <div class="yhjts-img">
                                <img src="../Common/image/wycz/no-dyq.png" alt="" />
                                <span>优惠券</span>
                            </div>
                            <div class="color-gray" id="totalCoupon"></div>
                        </div>
                        <div class="card-content">
                            <div id="couponList"> </div>
                        </div>
                        <div class="card-footer">
                            <label class="label-checkbox" style="padding-right: 0.75rem;">
                                <input type="checkbox" name="all-checkbox">
                                <div class="item-media">
                                    <i class="icon icon-form-checkbox"></i>&nbsp;&nbsp;全选
                                </div>
                            </label>
                            <div>
                                已选&nbsp;
                                <span id="selNum">0</span>&nbsp;张,可抵用&nbsp;
                                <span id="selPrice">0.00</span>&nbsp;元
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <!--生成二维码-->
        <div class="page" id="code">
            <div class="content">
                <div style="background-color: #FFFFFF;text-align:center;" class="code-title">
                    <div id="qrcodeCanvas" style="margin: 5% 23%;"></div>
                    <div class="price">00.00</div>
                    <div style="color: #999999;font-size: 0.65rem;">交易成功</div>
                </div>
                <div class="list-block" id="details">
                    <ul>
                        <li class="item-content">
                            <div class="item-inner">
                                <div class="item-title">账单分类</div>
                                <div class="item-after">加油</div>
                            </div>
                        </li>
                        <li class="item-content">
                            <div class="item-inner">
                                <div class="item-title">渠道信息</div>
                                <div class="item-after">油信宝</div>
                            </div>
                        </li>
                    </ul>
                </div>
                <div style="padding: 0.3rem 0.75rem;font-size: 0.7rem;">
                    <span style="color: #ff8200;">说明：</span>请在加油站向收银员出示此二维码
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
	 layer.open({
                //content: '加油用户请在支持核销的加油站扫描二维码购买加油券，此处购买加油券，不能为油卡充值，请谨慎操作。',
                content: '尊敬的用户，为了提升您的加油体验，我们正在对油信宝无卡加油模块进行检修与升级，由此带来的不便敬请谅解，与此同时，您可通过渠道申领油卡继续享受叠加优惠，感谢您的支持。',
                //btn: ['去加油', '取消'],
                //btn: ['确定', '取消'],
				shadeClose: false,
				shade: 1
            });
        var currentQRCode = "";
        var cjje = 0;
        var is_hd = 0;//是否有已抽中但是没有刷新到这个页面的优惠券；0：没有  1：有
        // 查询优惠券
        var SearchGift = function () {
            var proc = "支付_可用优惠券列表 " + Bill.userId;
            var rst = $$.JSONDB.Query(proc).Table;
            if (rst.length > 0) {
                for (var i = 0; i < rst.length; i++) {
                    rst[i].礼品价格 = rst[i].礼品价格.toFixed(2);
                    var time = rst[i].发放日期;
                    rst[i].发放日期 = time.substr(0, 4) + "-" + time.substr(4, 2) + "-" + time.substr(6, 2)
                }
                $$.Refill("#couponList", rst);
                $("#totalCoupon").text(rst.length + "张券可用/共" + rst.length + "张券");
                $("#dyq").show();

                $("#selNum").text("0");
                $("#selPrice").text("0.00");
            } else {
                $("#dyq").text("");
                $("#no-dyq").show();
                
            }
        }

    var timer;
    // 查询用户购买的加油券
        function queryCoupon() {
            var proc = "查询电子卡券 " + Bill.userId;
        var rst = $$.JSONDB.Query(proc).Table;
        if (rst.length > 0) {
            if (currentQRCode == rst[0].卡券码) {
                return;
            }
            currentQRCode = rst[0].卡券码;
            $("#main").removeClass("page-current");
            $("#code").addClass("page-current");
            $$.Fill("#details", rst[0]);
            $(".price").text(rst[0].卡券金额.toFixed(2));
            var codeUrl = rst[0].卡券码;
            $("#qrcodeCanvas").text("");

            var qrcode = new QRCode("qrcodeCanvas", {
                text: codeUrl,
                width: 200,
                height: 200,
                colorDark: '#000000',
                colorLight: '#ffffff',
                correctLevel: QRCode.CorrectLevel.H
            });
            if (!timer) {
                timer = setInterval(function () {
                    queryCoupon();
                }, 2000);
            }
        } else {
            SearchGift();
            $("#main").addClass("page-current");
            $("#code").removeClass("page-current");
            clearInterval(timer);
            timer = null; 
            var proccj = "查询可用抽奖次数 " + Bill.userId;
            var cjrst = $$.JSONDB.Query(proccj).Table;
            if (cjrst.length > 0) {
                if (cjrst[0].参与抽奖状态 == 0 && cjrst[0].可用抽奖次数 > 0) {//有可用次数，但是状态为0，证明用户是直接关闭窗口。清空所有。
                    var procsc = "删除用户随机立返机会 " + Bill.userId;
                    $$.JSONDB.Query(procsc).Table;
                }
            }
            sjlf();
        }
       
    }

        queryCoupon();

        // 结算
        $("#cz").click(function () {
		
		     layer.open({
                //content: '加油用户请在支持核销的加油站扫描二维码购买加油券，此处购买加油券，不能为油卡充值，请谨慎操作。',
                content: '尊敬的用户，为了提升您的加油体验，我们正在对油信宝无卡加油模块进行检修与升级，由此带来的不便敬请谅解，与此同时，您可通过渠道向本公司申领油卡继续享受叠加优惠，感谢您的支持。',
                //btn: ['去加油', '取消'],
                btn: ['确定', '取消'],
                yes: function (index) {
                    //$$.Goto('gmjyq');
                    layer.close(index);
                }
            });
			return;
            var proc = "查询电子卡券 " + Bill.userId;
            var rst = $$.JSONDB.Query(proc).Table;
            if (rst.length > 0) {
                layer.open({
                    content: "您有未核销的二维码，不用重复购买",
                    skin: 'msg',
                    time: 3,
                    end: function () {
                        currentQRCode = rst[0].卡券码;
                        $("#main").removeClass("page-current");
                        $("#code").addClass("page-current");
                        $$.Fill("#details", rst[0]);
                        $(".price").text(rst[0].卡券金额.toFixed(2));
                        var codeUrl = rst[0].卡券码;
                        $("#qrcodeCanvas").text("");
                        var qrcode = new QRCode("qrcodeCanvas", {
                            text: codeUrl,
                            width: 200,
                            height: 200,
                            colorDark: '#000000',
                            colorLight: '#ffffff',
                            correctLevel: QRCode.CorrectLevel.H
                        });
                        if (!timer) {
                            timer = setInterval(function () {
                                queryCoupon();
                            }, 2000);
                        }
                    }
                });
            } else {
                var num = $("input[type='number']").val();
                if (!num) {
                    layer.open({
                        content: '最低金额不能小于0.01元',
                        skin: 'msg',
                        time: 4
                    });
                    return;
                }

                var discountIDs = [];
                var data = {};

                // 通联支付金额以分为单位
                data.allAmount = num;
                var checkBox = $("input[name='my-checkbox']");
                if (checkBox.length > 0) {
                    for (var i = 0; i < checkBox.length; i++) {
                        if ($(checkBox[i]).prop("checked")) {
                            var checkedID = $(checkBox[i]).attr("id");
                            discountIDs.push(checkedID)
                        }
                    }
                    data.discountIDs = discountIDs.join(",");
                } else {
                    data.discountIDs = '';
                }
                data.trxamt = (Number(num) - Number(selPrice)) * 100;

                // data.appid = "00016005";
                data.body = "购买加油劵码";
                data.remark = "";
                data.orderType = "SaleCoupon";
                $$.GetWxJsApiParam(data, CallPay);
            }        
        });

    //调用微信JS api 支付
    var JsApiCall = function (wxJsApiParam) {
        WeixinJSBridge.invoke(
            'getBrandWCPayRequest',
            wxJsApiParam, //josn串
            function (res) {
                WeixinJSBridge.log(res.err_msg);
                var msg = "购买成功";
                if (res.err_msg == "get_brand_wcpay_request:ok") {
                    queryCoupon();

                    timer = setInterval(function () {
                        queryCoupon();
                    }, 2000);
                } else {
                    msg = "购买失败";
                }
                layer.open({
                    content: msg,
                    skin: 'msg',
                    time: 3
                });
                });
        }

        var CallPay = function (wxJsApiParam) {
            if (typeof WeixinJSBridge == "undefined") {
                if (document.addEventListener) {
                    document.addEventListener('WeixinJSBridgeReady', JsApiCall(wxJsApiParam), false);
                } else if (document.attachEvent) {
                    document.attachEvent('WeixinJSBridgeReady', JsApiCall(wxJsApiParam));
                    document.attachEvent('onWeixinJSBridgeReady', JsApiCall(wxJsApiParam));
                }
            } else {
                JsApiCall(wxJsApiParam);
            }
        };

        // 全选
        var isCheckAll = false;
        var selNum = 0;
        var selPrice = 0;
        $("input[name='all-checkbox']").click(function () {
            var num = Number($("input[type='number']").val());
            if (!num) {
                layer.open({
                    content: "请先输入加油金额",
                    skin: 'msg',
                    time: 3
                });
                $(this).prop("checked", false);
                return
            }

            selNum = 0, selPrice = 0;
            if (isCheckAll) {
                $("input[name='my-checkbox']").each(function () {
                    this.checked = false;
                });
                isCheckAll = false;
            } else {
                $("input[name='my-checkbox']").each(function () {
                    this.checked = true;
                    selNum++;
                    selPrice += Number(this.value);
                });
                isCheckAll = true;
                if ((num - selPrice).toFixed(2) <= 0) {
                    layer.open({
                        content: "优惠金额不能大于等于输入金额",
                        skin: 'msg',
                        time: 3
                    });
                    selNum = 0, selPrice = 0;
                    $(this).prop("checked", false);
                    $("input[name='my-checkbox']").prop("checked", false);
                    isCheckAll = false;
                    return
                }
            }
            var total = (num - selPrice).toFixed(2);
            $("#total").text("￥" + total);
            $("#selNum").text(selNum);
            $("#selPrice").text(selPrice.toFixed(2));
        });

        // 优惠券复选
        $("#couponList").on("click", "input[name='my-checkbox']", function () {
            var num = Number($("input[type='number']").val());
            if (!num) {
                layer.open({
                    content: "请先输入加油金额",
                    skin: 'msg',
                    time: 3
                });
                $(this).prop("checked", false);
                return
            }

            var isChecked = $(this).prop("checked");
            if (isChecked == true) {
                selNum++;
                selPrice += Number($(this).val());
                if ((num - selPrice).toFixed(2) <= 0) {
                    layer.open({
                        content: "优惠金额不能大于等于输入金额",
                        skin: 'msg',
                        time: 3
                    });
                    selNum--;
                    selPrice -= Number($(this).val());
                    $(this).prop("checked", false);
                    return
                }
            } else {
                selNum = selNum == 0 ? 0 : selNum - 1;
                selPrice -= Number($(this).val());
            }
            var checkedArr = $("input[name='my-checkbox']").not(function () {
                return !this.checked
            });

            if (checkedArr.length == 0) {
                $("input[name='all-checkbox']").prop("checked", false);
            }

            var total = (num - selPrice).toFixed(2);
            $("#total").text("￥" + total);
            $("#selNum").text(selNum);
            $("#selPrice").text(selPrice.toFixed(2));
        });

        // 输入框失去焦点
        $("input[type='number']").bind('input propertychange', function () {
            var num = $(this).val();
            var total = Number(num).toFixed(2);
            $("#total").text("￥" + total);
        });
        $(".quxiao").click(function () {
            var procsc = "删除用户随机立返机会 " + Bill.userId;
            $$.JSONDB.Query(procsc).Table;
            if (localStorage.getItem('获得')) {
                is_hd = localStorage.getItem('获得');
            }
            if (is_hd > 0) {
                localStorage.getItem('获得',0)
                location.reload();
            } else {

                $('.shuoming-box').hide();  //隐藏弹窗
                $('#cover').css('display', 'none');   //显示遮罩层
            }
           
        })

        $(".huojiang-guanbi").click(function () {
            var proccj = "查询可用抽奖次数 " + Bill.userId;
            var cjrst = $$.JSONDB.Query(proccj).Table;
            if (cjrst.length > 0) {
                if (cjrst[0].可用抽奖次数 > 0) {
                    localStorage.setItem("获得", 1);
                    $('.huojiang-box').hide();  //隐藏弹窗
                    $('#cover').css('display', 'none');   //显示遮罩层
                    sjlf();
                }
                else {
                    location.reload();
                }
            } else {
                location.reload();
            }
        })
        $(".weihuojiang-guanbi").click(function () {
            if (localStorage.getItem('获得')) {
                is_hd = localStorage.getItem('获得');
            }
            var proccj = "查询可用抽奖次数 " + Bill.userId;
            var cjrst = $$.JSONDB.Query(proccj).Table;
            if (cjrst.length > 0) {
                if (cjrst[0].可用抽奖次数 > 0) {
                    $('.weihuojiang-box').hide();  //隐藏弹窗
                    $('#cover').css('display', 'none');   //显示遮罩层
                    sjlf()
                }
                else {//已抽完
                    if (is_hd > 0) { //前面几次抽中了，需要刷新页面
                        location.reload();
                    } else { //前面几次没有抽中了，直接关闭提示
                        $('.weihuojiang-box').hide();  //隐藏弹窗
                        $('#cover').css('display', 'none');   //显示遮罩层
                    }
                }
            } else {//非正常情况
                $('.weihuojiang-box').hide();  //隐藏弹窗
                $('#cover').css('display', 'none');   //显示遮罩层
            }

            
        })
       
        // 立即抽奖按钮
        $(".quding").click(function () {
            $('.shuoming-box').hide();  //隐藏弹窗
            $('#cover').css('display', 'none');   //显示遮罩层
            if (cjje > 0) {
                var procYhcj = "获得抽奖礼品 " + Bill.userId + ',' + cjje;
                var yhcjRst = $$.JSONDB.Query(procYhcj).Table;
                if (yhcjRst.length > 0) {
                    $(".huojiang-content").html("<span>¥</span>" + cjje);
                    $(".huojiang-box").show();
                    $('#cover').css('display', 'block'); //显示遮罩层
                    $('#cover').css('height', document.body.clientHeight + 'px');
                    var huojaingwidth = $(".huojiang-box").width();
                    $(".huojiang-box").css("height", huojaingwidth + 'px');

                }
            } else {
                $(".weihuojiang-box").show();
                $('#cover').css('display', 'block'); //显示遮罩层
                $('#cover').css('height', document.body.clientHeight + 'px');
                var weihuojaingwidth = $(".weihuojiang-box").width();
                $(".weihuojiang-box").css("height", weihuojaingwidth + 'px');
            }

        });

        function sjlf() {
            var proccj = "查询可用抽奖次数 " + Bill.userId;
            var cjrst = $$.JSONDB.Query(proccj).Table;
            if (cjrst.length > 0) {
                if (cjrst[0].可用抽奖次数 > 0) {
                    var procewmcj = "抽奖_二维码抽奖 " + Bill.userId + ',1';//每次只抽1次
                    var ewmcjRst = $$.JSONDB.Query(procewmcj).Table;
                    if (ewmcjRst.length > 0) {
                        cjje = ewmcjRst[0].抽奖金额
                    }
                    if (cjrst[0].参与抽奖状态 > 0) {
                        $(".shuoming-content").html("<div>恭喜您获得" + cjrst[0].可用抽奖次数 + "次</div>领取随机立减券机会");
                    } else {
                        $(".shuoming-content").html("<div>恭喜您还有" + cjrst[0].可用抽奖次数 + "次</div>领取随机立减券机会");
                    }
                   
                    $(".shuoming-box").show();
                    $('#cover').css('display', 'block'); //显示遮罩层
                    $('#cover').css('height', document.body.clientHeight + 'px');
                    var shuomingwidth = $(".shuoming-box").width();
                    $(".shuoming-box").css("height", shuomingwidth + 'px');
                }
            }
        }
    </script>
</body>

</html>