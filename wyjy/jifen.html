<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
		<meta name="misapplication-tap-highlight" content="no" />
		<meta name="HandheldFriendly" content="true" />
		<meta name="MobileOptimized" content="320" />
		<meta http-equiv="Expires" content="0" />
		<meta http-equiv="Pragma" content="no-cache" />
		<meta http-equiv="Cache-control" content="no-cache" />
		<meta http-equiv="Cache" content="no-cache" />
		<title></title>
		<link rel="stylesheet" href="../Common/css/mui.min.css" />
		<script type="text/javascript" src="../Common/js/zepto.js"></script>
		<script type="text/javascript" src="../Common/js/sm.js?1=1"></script>
		<script type="text/javascript" src="../Common/js/sm-extend.js"></script>
		<script type="text/javascript" src="../Common/js/sm-city-picker.js"></script>
		<script type="text/javascript" src="../Common/js/sdk.js"></script>
		<script type="text/javascript" src="../Common/js/sdk_data_validation.js"></script>
		<script type="text/javascript" src="../Common/js/sdk_db.js?1=1"></script>
		<script type="text/javascript" src="../Common/js/Bill.js"></script>
		<script type="text/javascript" src="../Common/js/jquery-3.1.1.js"></script>
		<script type="text/javascript" src="../Common/js/layer_mobile/layer.js"></script>
		<script type="text/javascript" src="../Common/js/vue.min.js"></script>
		<script src="https://cdn.staticfile.org/vue-resource/1.5.1/vue-resource.min.js"></script>
		<script type="text/javascript">
			// $$.Page_Load = function(){
			// 	$.init();
			// }
		</script>
		<style type="text/css">
			body{
				font-family: "微软雅黑";
			}
			.content{
				background: white;
				float: left;
				clear: both;
				width: 100%;
				height: 100vh;
				overflow-y: scroll;
			}
			.tops{
				width: 90%;
				height:150px;
				margin: 20px 5%;
				background: rgb(245,245,245);
				box-shadow: 0px 1px 10px rgba(0,0,0, 0.2);
				border-radius: 10px;
				margin-top: 62px;
			}
			#header{
				background: white;
			}
			.tops-title{
				text-align: center;
				padding-top: 30px;
				color: rgb(124,200,254);
				font-size: 1rem;
			}
			.tops-text{
				text-align: center;
				padding-top: 30px;
				font-size: 3rem;
				color: rgb(10,143,245);
				font-weight: bold;
			}
			.record{
				width: 100%;
				height: 30px;
				padding: 0 20px;
			}
			.record .left{
				float: left;
				font-weight: 600;
				font-size: 1.2rem;
			}
			.record .right{
				float: right;
				color: #ccc;
			}
			.chid{
				width: 90%;
				margin: 0 5%;
				/* padding: 0 20px; */
				border-radius: 5px;
				border:2px solid rgb(247,247,247);
			}
			.chid-parent{
				width: 100%;
				height: 55px;
				box-sizing: border-box;
				border-bottom: 1px solid rgb(231,231,231);
				padding: 0 20px;
			}
			.chid-parent .left{
				height: 55px;
				line-height: 55px;
				font-weight: 600;
				float: left;
			}
			.chid-parent .right{
				height: 55px;
				line-height: 55px;
				float: right;
				font-weight: 600;
			}
			.chid-parent .right span{
				color: rgb(250,170,19);
			}
			.liebiao{
				width: 100%;
				height: 80px;
				border-bottom: 1px solid rgb(231,231,231);
				padding: 20px;
				padding-top: 10px;
			}
			.liebiao:last-child{
				bottom: 0;
			}
			.liebiao .left{
				float: left;
			}
			.liebiao .left div{
				padding: 5px 0;
			}
			.liebiao .left div:first-child{
				font-weight: 600;
			}
			.liebiao .left div:last-child{
				color: #ccc;
			}
			.liebiao .right{
				float: right;
				padding-top: 10px;
				color: rgb(250,170,19);
			}
			.back{
				font-size: 1rem;
				float: left;
				height: 44px;
				line-height: 44px;
				color: rgb(55,136,197);
			}
			.liebiao:active{
				background:rgb(240,240,240);
			}
			.months{
				padding: 10px 2px;
				margin-top: 19px;
				margin-right: 5px;
				float: left;
				background: rgb(13,143,237);
			}
			.mui-title{
				font-weight: 600;
				font-size: 1.3rem;
			}
			.backs{
				float: left;
				width: 24px;
				height: 24px;
				margin-top: 10px;
			}
			.nexts{
				float: right;
				width: 24px;
				height: 24px;
				margin-top: 10px;
			}
			.record img{
				float: right;
				width: 20px;
				height: 20px;
			}
			.uls{
				position: absolute;
				top:30px;
				right:-10px;
				width: 100%;
				background: white;
				padding: 0 10px;
				width:100px;
				border:2px solid rgb(247,247,247); 
				display: none;
				
			}
			.uls div{
				height: 40px;
				text-align: center;
				line-height: 40px;
				border-bottom: 1px solid rgb(231,231,231);
			}
			.uls div:last-child{
				border: 0;
			}
			.uls div:hover{
				color: #0062CC;
			}
		</style>
	</head>
	<body>
		<div class="content" id="jifen">
			<header id="header" class="mui-bar mui-bar-nav">
				<div onclick="javascript :history.back(-1);" style="float: left;"><img class="backs" src="../Common/image/bzfk/back.png" >
				<div class="back" onclick="javascript :history.back(-1);">返回</div></div>
				<h1 class="mui-title">我的积分</h1>
				<img class="nexts" src="../Common/image/bzfk/nav_icon_shuoming.png" >
			</header>
			<div class="tops">
				<div class="tops-title">可用积分</div>
				<div class="tops-text">{{numprice}}</div>
			</div>
			<div class="record">
				<div class="left">积分记录</div>
				<div style="float: right;position: relative;" >
				<div class="bull" style="float: left;clear: both;"><img class="imgs" src="../Common/image/bzfk/next.png" >
				<div class="right rights">全部</div></div>
				<div class="uls">
					<div>全部</div>
					<div>获取</div>
					<div>使用</div>
				</div>
				</div>	
			</div>
			<div class="chid">
				<div class="chid-parent">
					<div class="months"></div>
					<div class="left">本月</div>
					<div class="right ">获取:&nbsp;<span>{{sumnumber}}</span></div>
				</div>
				<div class="chidren">
					<div class="liebiao" v-for="(item,index) in list" :key="index">
						<div class="left">
							<div style="font-size: 1rem;">{{item.SCORE_NOTE}}</div>
							<div style="font-size: 0.8rem;">{{item.SCORE_CREATE_TIME}}</div>
						</div>
						<div class="right">+{{item.SCORE}}</span></div>
					</div>
				</div>
			</div>
		</div>
	</body>
	<script type="text/javascript">
		var proc = "查询基本信息 " + Bill.userId;
		var rst = $$.JSONDB.Query(proc);
		var data = rst.Table[0];
		var userid=data.用户标识;
		new Vue({
			el:'#jifen',
			data:{
				monthsnumber:0,
				sumnumber:0,
				Id:userid,
				list:'',
				numprice:0
			},
			created(){
				var data=`{method:"GetUserScoreInfo",user_id:"${this.Id}"}`
				 this.$http.get('http://smstest.youxinbao.com.cn/App/Common/CSharp/app/user/UserInfo.ashx',
					{params:
					{
						params:data
					}
							
					}).then(function(data){
						console.log(data)
						var json=data.body
						console.log(json)
						if(json.result==0){
							layer.open({
								content: json.message
								,skin: 'msg'
								,time: 2 //2秒后自动关闭
							});
							return;
						}
						
						this.list=$.parseJSON(json.data_score_list)
						for(var i=0;i<this.list.length;i++){
							var leftval=this.list[i].SCORE_CREATE_TIME.split("T")
							this.list[i].SCORE_CREATE_TIME=leftval[0]+" "+leftval[1]
							this.sumnumber+=1
						}
						this.numprice=$.parseJSON(json.data_score)[0].SCORE
						// console.log(this.numprice)
						   
					},function(res){
						console.log(res);
					});
			}
		})
	</script>
	<script type="text/javascript">
		$(function(){
			var fage=false;
			$(".bull").click(function(){
				if(!fage){
					$(".imgs").attr('src','../Common/image/bzfk/down.png')
					$(".uls").slideDown();
					fage=true;
				}
				else{
					$(".imgs").attr('src','../Common/image/bzfk/next.png')
					$(".uls").slideUp();
					fage=false;
				}
			})
			$(".uls div").click(function(){
				var texts=$(this).text()
				$(".rights").text(texts)
				$(".imgs").attr('src','../Common/image/bzfk/next.png')
				$(".uls").slideUp();
				fage=false;
			})
		})
		
	</script>
</html>
